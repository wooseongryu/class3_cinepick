<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.itwillbs.cinepick.mapper.TicketMapper">

	<insert id="insertTicket" parameterType="map">
		INSERT
			INTO ticket
			VALUES (
				null
				, #{allTickets}
				, #{seats}
			)
	</insert>
	
	<insert id="insertTickets" parameterType="map">
<!-- 		INSERT -->
<!-- 			INTO book_temp -->
<!-- 			VALUES ( -->
<!-- 				null -->
<!-- 				, #{allTickets} -->
<!-- 				, #{seats} -->
<!-- 				, #{total} -->
<!-- 			) -->
			
		INSERT 
			INTO book_temp
			VALUES (
			    (SELECT CONCAT('R', LPAD(COALESCE(MAX(SUBSTRING(book_code, 2) + 1), 1), 5, '0')) FROM book_temp b)
			    , #{allTickets}
				, #{seats}
				, #{total}
				, #{sche_idx}
			);	
			
	</insert>

</mapper>